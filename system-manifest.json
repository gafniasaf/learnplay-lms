{
  "branding": {
    "name": "LearnPlay Platform",
    "tagline": "Adaptive learning with multi-role insights."
  },
  "data_model": {
    "root_entities": [
      {
        "name": "LearnerProfile",
        "slug": "learner-profile",
        "fields": [
          { "name": "full_name", "type": "string" },
          { "name": "avatar_url", "type": "string" },
          { "name": "grade_level", "type": "string" },
          { "name": "weekly_goal_minutes", "type": "number" },
          { "name": "current_assignment_id", "type": "string" },
          { "name": "goal_status", "type": "string" },
          { "name": "insights_snapshot", "type": "json" }
        ]
      },
      {
        "name": "Assignment",
        "slug": "assignment",
        "fields": [
          { "name": "title", "type": "string" },
          { "name": "status", "type": "enum", "options": ["draft", "scheduled", "in_progress", "graded", "archived"] },
          { "name": "subject", "type": "string" },
          { "name": "due_date", "type": "date" },
          { "name": "adaptive_cluster_id", "type": "string" },
          { "name": "ai_variant_id", "type": "string" },
          { "name": "learner_id", "type": "string" },
          { "name": "teacher_id", "type": "string" },
          { "name": "rubric", "type": "json" },
          { "name": "attachments", "type": "json" }
        ]
      },
      {
        "name": "CourseBlueprint",
        "slug": "course-blueprint",
        "fields": [
          { "name": "title", "type": "string" },
          { "name": "subject", "type": "string" },
          { "name": "difficulty", "type": "enum", "options": ["elementary", "middle", "high", "college"] },
          { "name": "catalog_path", "type": "string" },
          { "name": "multimedia_manifest", "type": "json" },
          { "name": "guard_status", "type": "enum", "options": ["pending", "passed", "failed"] },
          { "name": "published", "type": "boolean" },
          { "name": "notes", "type": "string" },
          { "name": "game_type", "type": "enum", "options": ["mcq", "audio_mcq", "visual_mcq", "drag_drop", "matching", "ordering", "timed_fluency", "numeric", "diagram"] }
        ]
      },
      {
        "name": "GameSession",
        "slug": "game-session",
        "fields": [
          { "name": "assignment_id", "type": "string" },
          { "name": "course_id", "type": "string" },
          { "name": "level", "type": "number" },
          { "name": "status", "type": "enum", "options": ["active", "completed", "abandoned"] },
          { "name": "start_time", "type": "date" },
          { "name": "end_time", "type": "date" },
          { "name": "score", "type": "number" },
          { "name": "accuracy", "type": "number" },
          { "name": "content_version", "type": "string" }
        ]
      },
      {
        "name": "MessageThread",
        "slug": "message-thread",
        "fields": [
          { "name": "title", "type": "string" },
          { "name": "participant_ids", "type": "json" },
          { "name": "last_message", "type": "string" },
          { "name": "unread_counts", "type": "json" },
          { "name": "pinned", "type": "boolean" }
        ]
      },
      {
        "name": "JobTicket",
        "slug": "job-ticket",
        "fields": [
          { "name": "job_type", "type": "string" },
          { "name": "status", "type": "enum", "options": ["queued", "running", "completed", "failed"] },
          { "name": "payload", "type": "json" },
          { "name": "result", "type": "json" },
          { "name": "target_id", "type": "string" }
        ]
      },
      {
        "name": "MasteryState",
        "slug": "mastery-state",
        "fields": [
          { "name": "student_id", "type": "string" },
          { "name": "ko_id", "type": "string" },
          { "name": "mastery", "type": "number" },
          { "name": "status", "type": "enum", "options": ["locked", "in-progress", "mastered"] },
          { "name": "evidence_count", "type": "number" },
          { "name": "last_practiced", "type": "date" }
        ]
      },
      {
        "name": "StudentGoal",
        "slug": "student-goal",
        "fields": [
          { "name": "student_id", "type": "string" },
          { "name": "title", "type": "string" },
          { "name": "target_minutes", "type": "number" },
          { "name": "progress_minutes", "type": "number" },
          { "name": "status", "type": "enum", "options": ["on_track", "behind", "completed"] },
          { "name": "due_at", "type": "date" }
        ]
      },
      {
        "name": "ClassMembership",
        "slug": "class-membership",
        "fields": [
          { "name": "class_id", "type": "string" },
          { "name": "user_id", "type": "string" },
          { "name": "role", "type": "enum", "options": ["student", "teacher"] }
        ]
      }
    ],
    "child_entities": [
      {
        "name": "SessionEvent",
        "slug": "session-event",
        "fields": [
          { "name": "assignment_id", "type": "string" },
          { "name": "question_ref", "type": "string" },
          { "name": "outcome", "type": "enum", "options": ["correct", "incorrect", "skipped", "hint"] },
          { "name": "duration_seconds", "type": "number" },
          { "name": "transcript", "type": "string" },
          { "name": "confidence_score", "type": "number" }
        ]
      },
      {
        "name": "GoalUpdate",
        "slug": "goal-update",
        "fields": [
          { "name": "learner_id", "type": "string" },
          { "name": "week_of", "type": "date" },
          { "name": "target_minutes", "type": "number" },
          { "name": "note", "type": "string" }
        ]
      }
    ]
  },
  "agent_jobs": [
    {
      "id": "draft_assignment_plan",
      "target_entity": "Assignment",
      "execution_mode": "synchronous",
      "ui": {
        "label": "Draft Plan",
        "icon": "Sparkles",
        "placement": "assignment_toolbar"
      },
      "prompt_template": "You are an adaptive learning coach. Given {{title}}, {{subject}}, {{learner_id}}, and recent session context, propose the next best set of activities. Return JSON {\"summary\": string, \"suggested_actions\": string[], \"updated_fields\": {\"ai_variant_id\": string, \"status\": string}}."
    },
    {
      "id": "ai_course_generate",
      "target_entity": "CourseBlueprint",
      "execution_mode": "async",
      "ui": {
        "label": "Generate Course",
        "icon": "WandSparkles",
        "placement": "catalog_builder"
      },
      "prompt_template": "Act as an instructional designer. Using {{subject}}, {{difficulty}}, and {{multimedia_manifest}}, output a full HTML/JSON pack with sections, objectives, CTA copy, and audio/video transcript references."
    },
    {
      "id": "guard_course",
      "target_entity": "CourseBlueprint",
      "execution_mode": "synchronous",
      "ui": {
        "label": "Run Guard",
        "icon": "ShieldCheck",
        "placement": "catalog_builder"
      },
      "prompt_template": "Review the provided course blueprint for missing CTAs, accessibility violations, and policy blockers. Respond with JSON {\"summary\": string, \"violations\": string[], \"status\": \"passed\"|\"failed\"}."
    },
    {
      "id": "compile_mockups",
      "target_entity": "CourseBlueprint",
      "execution_mode": "async",
      "prompt_template": "Compile supplied mockup HTML into React routes. Ensure every data-cta-id is preserved. Return JSON {\"success\": boolean, \"files_generated\": string[], \"errors\": string[]}."
    },
    {
      "id": "plan_matrix_run",
      "target_entity": "JobTicket",
      "execution_mode": "async",
      "prompt_template": "Execute the LearnPlay regression checklist (CTA clicks, guard job, accessibility). Return JSON {\"total_tests\": number, \"passed\": number, \"failed\": number, \"details\": [{\"name\": string, \"status\": string, \"notes\": string}]}."
    }
  ],
  "edge_functions": [
    { "id": "get-course", "input": { "courseId": "string" }, "output": { "envelope": "json" }, "description": "Retrieve course JSON from storage with ETag caching" },
    { "id": "save-course", "input": { "envelope": "json" }, "output": { "ok": "boolean", "etag": "number" }, "description": "Save course JSON to storage and update metadata" },
    { "id": "publish-course", "input": { "courseId": "string", "changelog": "string" }, "output": { "version": "number", "snapshotId": "string", "contentVersion": "number", "etag": "number", "publishedAt": "string" }, "description": "Publish course, create version snapshot, trigger embeddings" },
    { "id": "generate-course", "input": { "subject": "string", "difficulty": "string", "format": "string", "locale": "string" }, "output": { "jobId": "string" }, "description": "Generate a new course using AI strategies" },
    { "id": "update-course", "input": { "courseId": "string", "patch": "json", "etag": "number" }, "output": { "ok": "boolean", "etag": "number" }, "description": "Apply JSON Patch to course with optimistic concurrency" },
    { "id": "delete-course", "input": { "courseId": "string", "backup": "boolean" }, "output": { "ok": "boolean" }, "description": "Soft delete course, optionally backup JSON" },
    { "id": "archive-course", "input": { "courseId": "string" }, "output": { "ok": "boolean" }, "description": "Archive course in metadata" },
    { "id": "restore-course-version", "input": { "courseId": "string", "version": "number" }, "output": { "ok": "boolean" }, "description": "Restore course to a previous version" },
    { "id": "apply-course-patch", "input": { "courseId": "string", "patch": "json" }, "output": { "ok": "boolean", "etag": "number" }, "description": "Apply JSON Patch and create version snapshot" },
    { "id": "validate-course-structure", "input": { "courseId": "string" }, "output": { "ok": "boolean", "errors": "json" }, "description": "Validate course structure against invariants" },
    { "id": "fix-catalog-entry", "input": { "courseId": "string", "newId": "string" }, "output": { "ok": "boolean" }, "description": "Fix broken catalog entry by updating ID" },
    { "id": "editor-co-pilot", "input": { "action": "string", "subject": "string", "format": "string", "courseId": "string", "locale": "string" }, "output": { "jobId": "string" }, "description": "Co-pilot orchestrator for editor actions" },
    { "id": "editor-auto-fix", "input": { "courseId": "string", "apply": "boolean" }, "output": { "ok": "boolean", "preview": "json" }, "description": "Automated course fixes: repair, variants audit, generate missing" },
    { "id": "editor-repair-course", "input": { "courseId": "string", "jobId": "string", "dryRun": "boolean" }, "output": { "ok": "boolean" }, "description": "Repair course using generate-repair job" },
    { "id": "editor-variants-audit", "input": { "courseId": "string" }, "output": { "ok": "boolean", "coverage": "number" }, "description": "Audit course variant coverage" },
    { "id": "editor-variants-missing", "input": { "courseId": "string", "axes": "json", "dryRun": "boolean", "jobId": "string" }, "output": { "ok": "boolean", "preview": "json" }, "description": "Generate and apply missing variants" },
    { "id": "chat-course-assistant", "input": { "message": "string", "courseId": "string", "history": "json" }, "output": { "response": "string", "suggestions": "json" }, "description": "Conversational AI assistant for course authoring" },
    { "id": "generate-image", "input": { "courseId": "string", "itemId": "number", "prompt": "string", "style": "string" }, "output": { "jobId": "string" }, "description": "Enqueue image generation job" },
    { "id": "generate-hint", "input": { "courseId": "string", "itemId": "number" }, "output": { "hint": "string" }, "description": "Generate and apply hint to course item" },
    { "id": "media-runner", "input": {}, "output": { "processed": "number" }, "description": "Process pending media jobs (images)" },
    { "id": "enqueue-course-media", "input": { "courseId": "string", "itemId": "number", "prompt": "string" }, "output": { "jobId": "string" }, "description": "Enqueue media job for course item" },
    { "id": "enqueue-course-missing-images", "input": { "courseId": "string", "limit": "number", "dryRun": "boolean", "promptTemplate": "string" }, "output": { "enqueued": "number" }, "description": "Enqueue media jobs for items missing images" },
    { "id": "apply-job-result", "input": { "jobId": "string", "courseId": "string", "mergePlan": "json", "attachments": "json", "dryRun": "boolean" }, "output": { "ok": "boolean", "etag": "number" }, "description": "Apply job result (patch + attachments) to course" },
    { "id": "enqueue-job", "input": { "jobType": "string", "payload": "json" }, "output": { "jobId": "string" }, "description": "Enqueue AI job for processing" },
    { "id": "get-job", "input": { "id": "string" }, "output": { "job": "json", "events": "json" }, "description": "Get job status and events" },
    { "id": "list-jobs", "input": { "page": "number", "limit": "number" }, "output": { "items": "json", "total": "number" }, "description": "List AI jobs with pagination" },
    { "id": "list-courses", "input": { "includeArchived": "boolean", "limit": "number" }, "output": { "items": "json" }, "description": "List courses from catalog" },
    { "id": "list-media-jobs", "input": { "courseId": "string", "status": "string", "limit": "number" }, "output": { "items": "json" }, "description": "List media generation jobs" },
    { "id": "get-format-registry", "input": {}, "output": { "registry": "json" }, "description": "Get course format registry with schemas and merge rules" },
    { "id": "generate-variants-audit", "input": { "courseId": "string" }, "output": { "ok": "boolean", "coverage": "number" }, "description": "Generate variants audit job" },
    { "id": "generate-variants-missing", "input": { "courseId": "string", "axes": "json" }, "output": { "jobId": "string" }, "description": "Generate missing variants job" },
    { "id": "generate-repair", "input": { "courseId": "string" }, "output": { "jobId": "string" }, "description": "Generate repair job for course" },
    { "id": "generate-localize", "input": { "courseId": "string", "target_lang": "string" }, "output": { "jobId": "string", "mergePlan": "json" }, "description": "Generate localization job" },
    { "id": "item-generate-more", "input": { "courseId": "string", "count": "number" }, "output": { "jobId": "string" }, "description": "Generate more items for course" },
    { "id": "item-rewrite-quality", "input": { "courseId": "string", "itemId": "number" }, "output": { "jobId": "string" }, "description": "Rewrite item for quality improvement" },
    { "id": "item-cluster-audit", "input": { "courseId": "string" }, "output": { "ok": "boolean" }, "description": "Audit item clustering" },
    { "id": "studytext-rewrite", "input": { "courseId": "string", "index": "number" }, "output": { "jobId": "string" }, "description": "Rewrite study text" },
    { "id": "studytext-expand", "input": { "courseId": "string", "index": "number" }, "output": { "jobId": "string" }, "description": "Expand study text" },
    { "id": "studytext-visualize", "input": { "courseId": "string", "index": "number" }, "output": { "jobId": "string" }, "description": "Generate visualization for study text" },
    { "id": "list-templates", "input": {}, "output": { "items": "json" }, "description": "List job templates" },
    { "id": "get-template", "input": { "id": "string" }, "output": { "template": "json" }, "description": "Get job template by ID" },
    { "id": "get-org-settings", "input": { "orgId": "string" }, "output": { "settings": "json" }, "description": "Get organization settings" },
    { "id": "save-org-settings", "input": { "orgId": "string", "thresholds": "json" }, "output": { "ok": "boolean" }, "description": "Save organization settings" },
    { "id": "generate-assignment", "input": { "topic": "string" }, "output": { "jobId": "string" } },
    { "id": "generate-remediation", "input": { "subject": "string", "itemsPerGroup": "number" }, "output": { "jobId": "string" } },
    { "id": "mcp-metrics-proxy", "input": { "type": "string" }, "output": { "ok": "boolean" } },
    { "id": "game-start-round", "input": { "courseId": "string", "level": "number", "assignmentId": "string" }, "output": { "sessionId": "string", "roundId": "string" } },
    { "id": "game-log-attempt", "input": { "roundId": "string", "itemId": "number", "isCorrect": "boolean", "latencyMs": "number", "finalize": "boolean" }, "output": { "attemptId": "string" } },
    { "id": "get-analytics", "input": { "courseId": "string", "range": "string" }, "output": { "dailyData": "json", "summary": "json" } },
    { "id": "get-student-skills", "input": { "studentId": "string", "domain": "string", "status": "string" }, "output": { "skills": "json", "totalCount": "number" } },
    { "id": "update-mastery", "input": { "studentId": "string", "koId": "string", "exerciseScore": "number" }, "output": { "oldMastery": "number", "newMastery": "number" } },
    { "id": "get-domain-growth", "input": { "studentId": "string" }, "output": { "domains": "json" } },
    { "id": "get-recommended-courses", "input": { "koId": "string", "studentId": "string" }, "output": { "courses": "json" } },
    { "id": "create-class", "input": { "name": "string", "description": "string" }, "output": { "class": "json" } },
    { "id": "add-class-member", "input": { "classId": "string", "studentEmail": "string" }, "output": { "ok": "boolean" } },
    { "id": "remove-class-member", "input": { "classId": "string", "studentId": "string" }, "output": { "ok": "boolean" } },
    { "id": "invite-student", "input": { "orgId": "string", "classId": "string", "email": "string" }, "output": { "inviteId": "string", "success": "boolean" } },
    { "id": "generate-class-code", "input": { "classId": "string", "refreshCode": "boolean" }, "output": { "code": "string", "expiresAt": "string" } },
    { "id": "join-class", "input": { "code": "string" }, "output": { "success": "boolean", "classId": "string" } },
    { "id": "create-child-code", "input": { "studentId": "string" }, "output": { "code": "string", "expiresAt": "string" } },
    { "id": "link-child", "input": { "code": "string" }, "output": { "success": "boolean", "childId": "string" } },
    { "id": "send-message", "input": { "recipientId": "string", "content": "string" }, "output": { "messageId": "string", "success": "boolean" } },
    { "id": "list-conversations", "input": {}, "output": { "conversations": "json" } },
    { "id": "list-messages", "input": { "conversationWith": "string", "limit": "number" }, "output": { "messages": "json", "nextCursor": "string" } },
    { "id": "save-record", "input": { "entity": "string", "values": "json" }, "output": { "ok": "boolean" } },
    { "id": "get-record", "input": { "entity": "string", "id": "string" }, "output": { "record": "json" } },
    { "id": "list-records", "input": { "entity": "string", "limit": "number" }, "output": { "items": "json" } }
  ]
}

