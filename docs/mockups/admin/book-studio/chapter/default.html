<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Studio - Chapter Editor</title>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../_base.css">
  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-card: #1a1a24;
      --bg-elevated: #22222e;
      --bg-hover: #2a2a38;
      --border: #2d2d3a;
      --border-accent: #3d3d4a;
      --text: #f5f5f7;
      --text-secondary: #a0a0b0;
      --text-muted: #6b6b7a;
      --accent-gold: #d4a853;
      --accent-gold-dim: rgba(212, 168, 83, 0.15);
      --accent-emerald: #34d399;
      --accent-rose: #f472b6;
      --accent-blue: #60a5fa;
      --accent-purple: #a78bfa;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'DM Sans', -apple-system, sans-serif;
      background: var(--bg-deep);
      color: var(--text);
      min-height: 100vh;
    }

    /* Header */
    .header {
      position: sticky; top: 0; z-index: 100;
      background: rgba(10, 10, 15, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 0 24px; height: 64px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .header-left { display: flex; align-items: center; gap: 16px; }
    .back-btn {
      display: flex; align-items: center; gap: 6px;
      padding: 6px 14px; border-radius: 6px; font-size: 13px;
      color: var(--text-secondary); text-decoration: none;
      border: 1px solid var(--border); transition: all 0.2s;
    }
    .back-btn:hover { background: var(--bg-hover); color: var(--text); }
    .chapter-title-header {
      font-family: 'Crimson Pro', serif;
      font-size: 18px; font-weight: 600;
    }
    .chapter-meta { font-size: 12px; color: var(--text-muted); }
    .header-actions { display: flex; gap: 10px; }
    .btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 14px; border-radius: 6px; font-size: 13px;
      font-weight: 500; cursor: pointer; border: none;
      font-family: inherit; transition: all 0.2s;
    }
    .btn-outline {
      background: transparent; border: 1px solid var(--border);
      color: var(--text-secondary);
    }
    .btn-outline:hover { background: var(--bg-hover); color: var(--text); }
    .btn-primary {
      background: linear-gradient(135deg, var(--accent-gold), #b8860b);
      color: #0a0a0f; font-weight: 600;
    }
    .btn-primary:hover { box-shadow: 0 4px 16px rgba(212, 168, 83, 0.3); }
    .btn-ai {
      background: rgba(167, 139, 250, 0.15);
      border: 1px solid var(--accent-purple);
      color: var(--accent-purple);
    }
    .btn-ai:hover { background: var(--accent-purple); color: var(--bg-deep); }

    /* Layout */
    .main { display: grid; grid-template-columns: 240px 1fr 280px; height: calc(100vh - 64px); }

    /* Section Nav */
    .section-nav {
      background: var(--bg-surface);
      border-right: 1px solid var(--border);
      padding: 16px 0; overflow-y: auto;
    }
    .nav-title {
      padding: 8px 16px; font-size: 11px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.5px;
      color: var(--text-muted);
    }
    .nav-item {
      display: flex; align-items: center; gap: 8px;
      padding: 10px 16px; font-size: 13px;
      color: var(--text-secondary); cursor: pointer;
      border-left: 3px solid transparent; transition: all 0.15s;
    }
    .nav-item:hover { background: var(--bg-hover); color: var(--text); }
    .nav-item.active {
      background: var(--accent-gold-dim);
      border-left-color: var(--accent-gold);
      color: var(--accent-gold);
    }
    .nav-item .status {
      width: 8px; height: 8px; border-radius: 50%; margin-left: auto;
    }
    .nav-item .status.edited { background: var(--accent-gold); }
    .nav-item .status.complete { background: var(--accent-emerald); }

    /* Content Editor */
    .content-editor { padding: 24px; overflow-y: auto; }
    .section-header-block {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px; padding: 16px 20px;
      margin-bottom: 20px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .section-title-text {
      font-family: 'Crimson Pro', serif;
      font-size: 20px; font-weight: 600;
    }
    .section-actions { display: flex; gap: 8px; }

    /* Paragraph Card */
    .para-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px; margin-bottom: 16px;
      transition: border-color 0.2s;
    }
    .para-card:hover { border-color: var(--border-accent); }
    .para-card.editing { border-color: var(--accent-gold); }
    .para-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px; border-bottom: 1px solid var(--border);
    }
    .para-id {
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px; color: var(--text-muted);
    }
    .para-badges { display: flex; gap: 6px; }
    .para-badge {
      padding: 3px 8px; border-radius: 4px; font-size: 10px;
      font-weight: 600; text-transform: uppercase;
    }
    .para-badge.edited { background: rgba(212, 168, 83, 0.2); color: var(--accent-gold); }
    .para-badge.microhead { background: rgba(96, 165, 250, 0.2); color: var(--accent-blue); }
    .para-badge.verdieping { background: rgba(167, 139, 250, 0.2); color: var(--accent-purple); }

    .para-content { padding: 16px; }
    .microheading-row {
      display: flex; align-items: center; gap: 10px;
      margin-bottom: 12px; padding-bottom: 12px;
      border-bottom: 1px dashed var(--border);
    }
    .microheading-input {
      flex: 1; background: var(--bg-elevated);
      border: 1px solid var(--border); border-radius: 6px;
      padding: 8px 12px; color: var(--text);
      font-size: 14px; font-weight: 600;
    }
    .microheading-input:focus { border-color: var(--accent-blue); outline: none; }
    .text-display {
      font-size: 14px; line-height: 1.7;
      color: var(--text-secondary); white-space: pre-wrap;
    }
    .text-edit {
      width: 100%; min-height: 120px; resize: vertical;
      background: var(--bg-elevated); border: 1px solid var(--border);
      border-radius: 6px; padding: 12px; color: var(--text);
      font-size: 14px; line-height: 1.7; font-family: inherit;
    }
    .text-edit:focus { border-color: var(--accent-gold); outline: none; }

    /* Image placeholder */
    .image-placeholder {
      margin-top: 16px; padding: 20px;
      background: linear-gradient(135deg, rgba(212, 168, 83, 0.05), transparent);
      border: 2px dashed var(--border);
      border-radius: 8px; text-align: center;
    }
    .image-placeholder.has-image { border-style: solid; }
    .image-placeholder img {
      max-width: 100%; max-height: 200px;
      border-radius: 6px; margin-bottom: 12px;
    }
    .image-placeholder-text {
      font-size: 13px; color: var(--text-muted); margin-bottom: 12px;
    }
    .image-actions { display: flex; justify-content: center; gap: 8px; }
    .image-btn {
      padding: 8px 14px; border-radius: 6px; font-size: 12px;
      cursor: pointer; border: 1px solid var(--border);
      background: var(--bg-elevated); color: var(--text-secondary);
      transition: all 0.2s;
    }
    .image-btn:hover { background: var(--bg-hover); color: var(--text); }
    .image-btn.ai {
      background: rgba(167, 139, 250, 0.15);
      border-color: var(--accent-purple);
      color: var(--accent-purple);
    }
    .image-btn.ai:hover { background: var(--accent-purple); color: #fff; }

    /* Para footer actions */
    .para-footer {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px; background: var(--bg-elevated);
      border-top: 1px solid var(--border);
      border-radius: 0 0 10px 10px;
    }
    .para-actions { display: flex; gap: 6px; }
    .para-btn {
      padding: 6px 12px; border-radius: 5px; font-size: 12px;
      cursor: pointer; border: 1px solid var(--border);
      background: transparent; color: var(--text-muted); transition: all 0.2s;
    }
    .para-btn:hover { background: var(--bg-hover); color: var(--text); border-color: var(--border-accent); }
    .para-btn.primary { background: var(--accent-gold); color: var(--bg-deep); border-color: var(--accent-gold); }
    .para-btn.ai { border-color: var(--accent-purple); color: var(--accent-purple); }
    .para-btn.ai:hover { background: var(--accent-purple); color: #fff; }

    /* Version Panel */
    .version-panel {
      background: var(--bg-surface);
      border-left: 1px solid var(--border);
      padding: 20px; overflow-y: auto;
    }
    .panel-title {
      font-size: 13px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.5px;
      color: var(--text-muted); margin-bottom: 16px;
    }
    .version-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px; padding: 12px;
      margin-bottom: 10px; cursor: pointer;
      transition: all 0.2s;
    }
    .version-card:hover { border-color: var(--accent-gold); }
    .version-card.current { border-color: var(--accent-emerald); }
    .version-label {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 6px;
    }
    .version-tag {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px; font-weight: 600;
    }
    .version-current {
      font-size: 10px; padding: 2px 6px;
      background: rgba(52, 211, 153, 0.2);
      color: var(--accent-emerald);
      border-radius: 4px;
    }
    .version-date { font-size: 12px; color: var(--text-muted); }
    .version-diff { font-size: 11px; color: var(--accent-gold); margin-top: 8px; }
    .version-actions { display: flex; gap: 6px; margin-top: 10px; }
  </style>
</head>
<body data-route="/admin/book-studio/:bookId/chapters/:chapterIndex">
  <header class="header">
    <div class="header-left">
      <a href="/admin/book-studio/pathologie_n4" class="back-btn" data-cta-id="cta-bookstudio-back-to-book" data-action="navigate">
        ‚Üê Book
      </a>
      <div>
        <div class="chapter-title-header">Chapter 3: Afwijkende reflexen</div>
        <div class="chapter-meta">55 paragraphs ‚Ä¢ 8/14 images ‚Ä¢ v3</div>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline" data-cta-id="cta-bookstudio-book-versions" data-action="navigate">üìú Versions</button>
      <button class="btn btn-outline" data-cta-id="cta-bookstudio-view-edit" data-action="action">Edit</button>
      <button class="btn btn-outline" data-cta-id="cta-bookstudio-view-proof" data-action="action">Proof</button>
      <button class="btn btn-outline" data-cta-id="cta-bookstudio-book-render" data-action="action">üìÑ Render PDF</button>
      <button class="btn btn-ai" data-cta-id="cta-bookstudio-chapter-ai-rewrite-all" data-action="action">ü§ñ AI Rewrite Chapter</button>
      <button class="btn btn-outline" data-cta-id="cta-bookstudio-chapter-discard" data-action="action">Discard</button>
      <button class="btn btn-primary" data-cta-id="cta-bookstudio-chapter-save" data-action="action">üíæ Save All</button>
    </div>
  </header>

  <main class="main">
    <!-- New WYSIWYG (PDF-like) controls placeholder (kept in sync with React editor CTAs) -->
    <div style="margin: 16px 24px; padding: 12px; border: 1px dashed var(--border-accent); border-radius: 10px; background: rgba(212, 168, 83, 0.06);">
      <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
        <div style="font-size:12px; color: var(--text-secondary); font-weight: 600;">PDF-like WYSIWYG</div>
        <div style="display:flex; align-items:center; gap:8px;">
          <span style="font-size:12px; color: var(--text-secondary);">Zoom</span>
          <input type="range" min="50" max="200" step="25" value="100" data-cta-id="cta-bookstudio-wysiwyg-zoom" data-action="action" />
        </div>
        <button class="btn btn-outline" data-cta-id="cta-bookstudio-proof-refresh" data-action="action">Refresh Proof</button>
        <button class="btn btn-outline" data-cta-id="cta-bookstudio-proof-open" data-action="action">Open PDF</button>
        <button class="btn btn-outline" data-cta-id="cta-bookstudio-proof-open-run" data-action="navigate">Open Run</button>
      </div>
      <div style="display:flex; gap:16px; margin-top: 12px;">
        <div style="flex:1; min-width: 280px;">
          <div style="font-size:12px; color: var(--text-secondary); margin-bottom: 6px;">Preview (placeholder)</div>
          <iframe title="Preview" style="width:100%; height: 220px; border: 1px solid var(--border); border-radius: 8px; background: white;" data-cta-id="cta-bookstudio-preview-iframe" data-action="noop"></iframe>
        </div>
        <div style="width: 320px; min-width: 260px;">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom: 6px;">
            <div style="font-size:12px; color: var(--text-secondary);">Inspector (placeholder)</div>
            <button class="btn btn-outline" style="padding: 6px 10px;" data-cta-id="cta-bookstudio-inspector-clear-selection" data-action="action">Clear</button>
          </div>
          <textarea style="width:100%; height: 140px; background: var(--bg-surface); border: 1px solid var(--border); color: var(--text); border-radius: 8px; padding: 10px; font-family: 'JetBrains Mono', monospace; font-size: 11px;" data-cta-id="cta-bookstudio-inspector-html" data-action="edit"></textarea>
          <div style="display:flex; gap:8px; margin-top: 8px;">
            <button class="btn btn-ai" style="padding: 6px 10px;" data-cta-id="cta-bookstudio-inspector-ai-rewrite" data-action="action">AI rewrite</button>
            <button class="btn btn-outline" style="padding: 6px 10px;" data-cta-id="cta-bookstudio-inspector-revert" data-action="action">Revert</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Section Navigation -->
    <nav class="section-nav">
      <div class="nav-title">Sections</div>
      <div class="nav-item" data-cta-id="cta-bookstudio-nav-section-0" data-action="navigate">
        <span>3.1</span> Inleiding <span class="status complete"></span>
      </div>
      <div class="nav-item active" data-cta-id="cta-bookstudio-nav-section-1" data-action="navigate">
        <span>3.2</span> Reflexboog <span class="status edited"></span>
      </div>
      <div class="nav-item" data-cta-id="cta-bookstudio-nav-section-2" data-action="navigate">
        <span>3.3</span> Neurologisch onderzoek
      </div>
      <div class="nav-item" data-cta-id="cta-bookstudio-nav-section-3" data-action="navigate">
        <span>3.4</span> Afwijkingen
      </div>
      <div class="nav-item" data-cta-id="cta-bookstudio-nav-section-4" data-action="navigate">
        <span>3.5</span> Klinische praktijk
      </div>
    </nav>

    <!-- Content Editor -->
    <div class="content-editor">
      <div class="section-header-block">
        <div class="section-title-text">3.2 De reflexboog</div>
        <div class="section-actions">
          <button class="btn btn-ai" data-cta-id="cta-bookstudio-section-ai-rewrite" data-action="action">ü§ñ Rewrite Section</button>
          <button class="btn btn-outline" data-cta-id="cta-bookstudio-section-add-image" data-action="action">üñºÔ∏è Add Image</button>
        </div>
      </div>

      <!-- Paragraph 1 - With microheading -->
      <div class="para-card">
        <div class="para-header">
          <span class="para-id">para-8020139d-b843</span>
          <div class="para-badges">
            <span class="para-badge microhead">Microheading</span>
          </div>
        </div>
        <div class="para-content">
          <div class="microheading-row">
            <input type="text" class="microheading-input" value="Wat is een reflexboog?" data-cta-id="cta-bookstudio-para-microhead-0" data-action="edit" />
            <button class="para-btn ai" data-cta-id="cta-bookstudio-para-suggest-microhead-0" data-action="action">üí° Suggest</button>
          </div>
          <div class="text-display">Een reflexboog is het pad dat een zenuwimpuls aflegt bij een reflex. Het bestaat uit vijf onderdelen: receptor, sensorische zenuw, schakelcentrum, motorische zenuw en effector. De receptor vangt de prikkel op. De sensorische zenuw geleidt de prikkel naar het ruggenmerg.</div>
        </div>
        <div class="para-footer">
          <div class="para-actions">
            <button class="para-btn" data-cta-id="cta-bookstudio-para-edit-0" data-action="action">‚úèÔ∏è Edit</button>
            <button class="para-btn ai" data-cta-id="cta-bookstudio-para-ai-rewrite-0" data-action="action">ü§ñ AI Rewrite</button>
            <button class="para-btn" data-cta-id="cta-bookstudio-para-select-rewrite-0" data-action="action">‚úÇÔ∏è Select Text</button>
          </div>
          <button class="para-btn" data-cta-id="cta-bookstudio-para-revert-0" data-action="action">‚Ü© Revert</button>
        </div>
      </div>

      <!-- Paragraph 2 - Edited, with image placeholder -->
      <div class="para-card editing">
        <div class="para-header">
          <span class="para-id">para-9b4f45d7-2a1c</span>
          <div class="para-badges">
            <span class="para-badge edited">Edited</span>
          </div>
        </div>
        <div class="para-content">
          <textarea class="text-edit" data-cta-id="cta-bookstudio-para-text-1" data-action="edit">Het schakelcentrum bevindt zich in het ruggenmerg. Hier wordt de prikkel verwerkt en doorgestuurd. De motorische zenuw brengt het signaal naar de effector. De effector is meestal een spier die samentrekt.</textarea>
          <div class="image-placeholder">
            <div class="image-placeholder-text">üì∑ Click to add an image for this paragraph</div>
            <div class="image-actions">
              <button class="image-btn" data-cta-id="cta-bookstudio-para-image-upload-1" data-action="action">üì§ Upload</button>
              <button class="image-btn ai" data-cta-id="cta-bookstudio-para-image-ai-1" data-action="action">üé® AI Generate</button>
            </div>
          </div>
        </div>
        <div class="para-footer">
          <div class="para-actions">
            <button class="para-btn primary" data-cta-id="cta-bookstudio-para-save-1" data-action="action">üíæ Save</button>
            <button class="para-btn ai" data-cta-id="cta-bookstudio-para-ai-rewrite-1" data-action="action">ü§ñ AI Rewrite</button>
          </div>
          <button class="para-btn" data-cta-id="cta-bookstudio-para-revert-1" data-action="action">‚Ü© Revert</button>
        </div>
      </div>

      <!-- Paragraph 3 - Verdieping box -->
      <div class="para-card">
        <div class="para-header">
          <span class="para-id">para-c88e2b72-f912</span>
          <div class="para-badges">
            <span class="para-badge verdieping">Verdieping</span>
          </div>
        </div>
        <div class="para-content">
          <div class="text-display">De snelheid van een reflex hangt af van de myelinisatie van de zenuwvezels. Gemyeliniseerde vezels geleiden sneller door saltatore geleiding. Bij aandoeningen als multiple sclerose is de myeline beschadigd, wat leidt tot vertraagde of afwezige reflexen.</div>
          <div class="image-placeholder has-image">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200' viewBox='0 0 400 200'%3E%3Crect fill='%231a1a24' width='400' height='200'/%3E%3Ctext fill='%236b6b7a' x='200' y='100' text-anchor='middle' font-family='sans-serif' font-size='14'%3Eüß¨ Nerve fiber illustration%3C/text%3E%3C/svg%3E" alt="Nerve fiber" />
            <div class="image-actions">
              <button class="image-btn" data-cta-id="cta-bookstudio-para-image-replace-2" data-action="action">üîÑ Replace</button>
              <button class="image-btn" data-cta-id="cta-bookstudio-para-image-remove-2" data-action="action">üóëÔ∏è Remove</button>
            </div>
          </div>
        </div>
        <div class="para-footer">
          <div class="para-actions">
            <button class="para-btn" data-cta-id="cta-bookstudio-para-edit-2" data-action="action">‚úèÔ∏è Edit</button>
            <button class="para-btn ai" data-cta-id="cta-bookstudio-para-ai-rewrite-2" data-action="action">ü§ñ AI Rewrite</button>
          </div>
          <button class="para-btn" data-cta-id="cta-bookstudio-para-revert-2" data-action="action">‚Ü© Revert</button>
        </div>
      </div>
    </div>

    <!-- Version Panel -->
    <aside class="version-panel">
      <div class="panel-title">Version History</div>
      
      <div class="version-card current">
        <div class="version-label">
          <span class="version-tag">v3</span>
          <span class="version-current">Current</span>
        </div>
        <div class="version-date">Dec 29, 2025 14:32</div>
        <div class="version-diff">+12 paragraphs edited</div>
      </div>

      <div class="version-card" data-cta-id="cta-bookstudio-version-select-2" data-action="action">
        <div class="version-label">
          <span class="version-tag">v2</span>
        </div>
        <div class="version-date">Dec 28, 2025 11:05</div>
        <div class="version-diff">+8 paragraphs, 3 images</div>
        <div class="version-actions">
          <button class="para-btn" data-cta-id="cta-bookstudio-version-diff-2" data-action="action">View Diff</button>
          <button class="para-btn" data-cta-id="cta-bookstudio-version-revert-2" data-action="action">Revert</button>
        </div>
      </div>

      <div class="version-card" data-cta-id="cta-bookstudio-version-select-1" data-action="action">
        <div class="version-label">
          <span class="version-tag">v1</span>
        </div>
        <div class="version-date">Dec 27, 2025 09:22</div>
        <div class="version-diff">Initial import</div>
        <div class="version-actions">
          <button class="para-btn" data-cta-id="cta-bookstudio-version-diff-1" data-action="action">View Diff</button>
          <button class="para-btn" data-cta-id="cta-bookstudio-version-revert-1" data-action="action">Revert</button>
        </div>
      </div>

      <div class="panel-title" style="margin-top: 24px;">Paragraph History</div>
      <p style="font-size: 12px; color: var(--text-muted);">Select a paragraph to see its version history</p>
    </aside>
  </main>
</body>
</html>

